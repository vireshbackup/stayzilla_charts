<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8 />
		<title>Plain Leaflet API</title>

		<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
		<script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.js'></script>
		<link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
		
		<script type="text/javascript"  src="d3.js"></script>
		<script type="text/javascript" src="crossfilter.js"></script>

		<style>
		  body { margin:0; padding:0; }
		  #map { position:absolute; top:0; bottom:0; width:60%; }
		</style>
	</head>
	<body>

		<div id='map'></div>

		<script>


		L.mapbox.accessToken = 'pk.eyJ1IjoidGVqZXNoOTUiLCJhIjoiNTdlZWI0NGEwMzU1NmRmNzYzNzZmY2ZhMmY0YTFhMDAifQ.KTwxWh-vcPO6tv3IKHJvBQ';
		// Replace 'mapbox.streets' with your map id.
		var mapboxTiles = L.tileLayer('https://{s}.tiles.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=' + L.mapbox.accessToken, {
		    attribution: '<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'
		});


		var map = L.map('map')
		    .addLayer(mapboxTiles)
		    .setView([21.0000 , 78.0000], 5);
		
		//Initialize svg layer 
    	map._initPathRoot()

		var svg = d3.select("#map").select("svg"),
    	g = svg.append("g")

    	// Pick up SVG from map object
    	d3.csv("ltln3.csv", function(csv){

    		csv.forEach(function(d){
    			console.log(d);
    			d.LatLng = new L.LatLng(d.lat, d.lng);
    			console.log(d);

    		})

    		var feature = g.selectAll("circle")
    						.data(csv)
    						.enter()
    						.append("circle")
    						.style("fill", "#ED0974")
    						.attr("r", 2)
    						
    		map.on("viewreset", update);
    		update();

    		function update() {
    			feature.attr("transform", 
    				function(d){
    					// console.log(d, map.latLngToLayerPoint(d.LatLng).x);
    					return "translate(" + 
    						map.latLngToLayerPoint(d.LatLng).x + "," + 
    						map.latLngToLayerPoint(d.LatLng).y + ")";
    				})
    		}
    	})

		</script>
	</body>
</html>